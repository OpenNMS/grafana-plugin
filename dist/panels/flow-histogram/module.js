define(["@grafana/data","react","@grafana/ui"],(e,t,n)=>(()=>{"use strict";var o={2007:e=>{e.exports=n},5959:e=>{e.exports=t},7781:t=>{t.exports=e}},l={};function a(e){var t=l[e];if(void 0!==t)return t.exports;var n=l[e]={exports:{}};return o[e](n,n.exports,a),n.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};a.r(i),a.d(i,{plugin:()=>j});var r=a(7781),s=a(5959),d=a.n(s);const c=(e,t,n,o,l,a)=>{const i=l?o.divisor*a:o.divisor;return t.map(t=>{const o=t[y.indexLabel.index],l=e[o]/i;return n?[l,o]:[o,l]})},u=(e,t)=>{var n,o;return(null===(o=e.find(e=>e.name===t))||void 0===o||null===(n=o.values)||void 0===n?void 0:n.toArray())||[]},p=e=>{var t;if(!e||e.length<1)return console.log("No data, check the datasource is flow-datasource and function asSummaryTable are selected"),!1;const n=e[0];return!(!n.meta||!(null===(t=n.meta)||void 0===t?void 0:t.custom))||(console.log("Incorrect or incomplete data, check the datasource is flow-datasource and function asSummaryTable are selected"),!1)},m=(e,t,n,o)=>{const l="Under Graph"===o.flowHistogramOptions.position.label,a=o.flowHistogramOptions.showLegend;switch(e){case v.Container:return{display:a&&l?"block":"inline-block",float:a&&l?"none":"left"};case v.Legend:const e="Horizontal"===o.flowHistogramOptions.direction.label?0:25;return{display:a?l?"block":"inline-block":"none",width:l?n:.2*n-e,height:l?o.flowHistogramOptions.height:t,float:l?"none":"left"};case v.ContainerGraph:return{width:!a||l?n:.8*n,height:t-25-(a&&l?o.flowHistogramOptions.height:0)};case v.GraphAxisLabel:return{height:25,display:"flex",justifyContent:"center",alignItems:"center"};case v.GraphAxisLabelUnit:return{marginTop:24}}};var v;!function(e){e[e.Container=0]="Container",e[e.ContainerGraph=1]="ContainerGraph",e[e.GraphAxisLabel=2]="GraphAxisLabel",e[e.GraphAxisLabelUnit=3]="GraphAxisLabelUnit",e[e.Legend=4]="Legend"}(v||(v={}));const b=[{label:"Horizontal",value:"0"},{label:"Vertical",value:"1"}],g=[{label:"B",value:"0"},{label:"KB",value:"1"},{label:"MB",value:"2"},{label:"GB",value:"3"}],f=[{label:"Total",value:"0"},{label:"Rate",value:"1"}],h=[{label:"Separate",value:"0"},{label:"Stacked",value:"1"}],O=[{label:"Right Side",value:""},{label:"Under Graph",value:""}],w=(e,t)=>{var n,o,l,a;let i=1,r="Bytes";if(!p(t))return{units:r,divisor:i};const s=!!(null===(a=t)||void 0===a||null===(l=a[0])||void 0===l||null===(o=l.meta)||void 0===o||null===(n=o.custom)||void 0===n?void 0:n.toBits),d="Rate"===e.flowHistogramOptions.display.label;switch(e.flowHistogramOptions.units.label){case"B":r=s?"Bits":"Bytes";break;case"KB":i=1024,r=s?"Kb":"KB";break;case"MB":i=Math.pow(1024,2),r=s?"Mb":"MB";break;case"GB":i=Math.pow(1024,3),r=s?"Gb":"GB"}return d&&(r+="/s"),{units:r,divisor:i}},y={horizontal:{value:0,index:0,metric:1},vertical:{value:1,index:1,metric:0},indexLabel:{index:0,label:1}},H={dataIn:{label:"In",value:0},dataOut:{label:"Out",value:1}};var x=a(2007);function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const L=e=>{var t,n,{children:o}=e,l=function(e,t){if(null==e)return{};var n,o,l=function(e,t){if(null==e)return{};var n,o,l={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,["children"]);return d().createElement(d().Fragment,null,d().createElement("style",null,"\n                        .onms-inline-field > label{\n                            width:160px;\n                        }\n                    "),d().createElement(x.InlineField,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){E(e,t,n[t])})}return e}({},l),n=null!=(n={className:"onms-inline-field"})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t),o))},k=({className:e,children:t})=>d().createElement("div",{className:e,style:{display:"flex",alignItems:"center",height:32,width:32}},t);function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const B=({onChange:e,context:t})=>{var n,o,l,a,i,r,c,u,p,m,v,w,y,H,E,B,j,P,G,C,I;const[D,A]=(0,s.useState)({direction:(null===(o=t.options)||void 0===o||null===(n=o.flowHistogramOptions)||void 0===n?void 0:n.direction)||b[0],units:(null===(a=t.options)||void 0===a||null===(l=a.flowHistogramOptions)||void 0===l?void 0:l.units)||g[0],display:(null===(r=t.options)||void 0===r||null===(i=r.flowHistogramOptions)||void 0===i?void 0:i.display)||f[0],mode:(null===(u=t.options)||void 0===u||null===(c=u.flowHistogramOptions)||void 0===c?void 0:c.mode)||h[0],showLegend:(null===(m=t.options)||void 0===m||null===(p=m.flowHistogramOptions)||void 0===p?void 0:p.showLegend)||!0,position:(null===(w=t.options)||void 0===w||null===(v=w.flowHistogramOptions)||void 0===v?void 0:v.position)||O[0],height:(null===(H=t.options)||void 0===H||null===(y=H.flowHistogramOptions)||void 0===y?void 0:y.height)||42}),M=(e,t)=>{A(n=>{const o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){S(e,t,n[t])})}return e}({},n);return o[t]=e,o})};return(0,s.useEffect)(()=>{e(D)},[D]),d().createElement("div",null,d().createElement("p",{style:{marginTop:12,marginBottom:3}},"General"),d().createElement(L,{label:"Direction"},d().createElement(x.Select,{options:b,value:null===(E=D)||void 0===E?void 0:E.direction,onChange:e=>M(e,"direction")})),d().createElement(L,{label:"Units"},d().createElement(x.Select,{options:g,value:null===(B=D)||void 0===B?void 0:B.units,onChange:e=>M(e,"units")})),d().createElement(L,{label:"Display"},d().createElement(x.Select,{options:f,value:null===(j=D)||void 0===j?void 0:j.display,onChange:e=>M(e,"display")})),d().createElement(L,{label:"Mode"},d().createElement(x.Select,{options:h,value:null===(P=D)||void 0===P?void 0:P.mode,onChange:e=>M(e,"mode")})),d().createElement("p",{style:{marginTop:20,marginBottom:3}},"Legend"),d().createElement(L,{label:"Show Legend"},d().createElement(k,null,d().createElement(x.Switch,{value:null===(G=D)||void 0===G?void 0:G.showLegend,onChange:()=>{var e;return M(!(null===(e=D)||void 0===e?void 0:e.showLegend),"showLegend")}}))),d().createElement(L,{label:"Position"},d().createElement(x.Select,{options:O,value:null===(C=D)||void 0===C?void 0:C.position,onChange:e=>M(e,"position")})),d().createElement(L,{label:"Height"},d().createElement(x.Input,{type:"number",max:75,min:20,value:null===(I=D)||void 0===I?void 0:I.height,onChange:e=>M(Number.parseInt(e.currentTarget.value,10)>0?e.currentTarget.value:0,"height")})))},j=new r.PanelPlugin(({data:e,height:t,width:n,options:o})=>{var l;const a=(0,s.useRef)();return(0,s.useEffect)(()=>{var t;if(p(null===(t=e)||void 0===t?void 0:t.series)){const t=((e,t)=>{var n,o,l,a,i;if(1!==(null===(o=e)||void 0===o||null===(n=o.series)||void 0===n?void 0:n.length))throw new Error("Only one query is permitted in this panel");const r=e.series[0],s=r&&r.meta&&r.meta.custom?r.meta.custom.metric:void 0;if(!s)return{};const d="Stacked"===t.flowHistogramOptions.mode.label,p="Horizontal"===t.flowHistogramOptions.direction.label,m="Rate"===t.flowHistogramOptions.display.label,v=!!(null===(a=r.meta)||void 0===a||null===(l=a.custom)||void 0===l?void 0:l.toBits),b=v?"Bits In":"Bytes In",g=v?"Bits Out":"Bytes Out",f=u(r.fields,b),h=u(r.fields,g);let O=[],x=[],E=[];const{metricLabels:L,labelFunction:k}=((e,t)=>{let n=[],o=e=>e;switch(e){case"Applications":n=u(t.fields,"Application");break;case"Hosts":n=u(t.fields,"Host");break;case"Conversations":n=u(t.fields,"Application");const e=u(t.fields,"Source"),l=u(t.fields,"Dest.");o=(t,n)=>e[n]+" <-> "+l[n]+" ["+(t||"Unknown")+"]"}return{metricLabels:n,labelFunction:o}})(s,r),S=((e,t)=>e.map((e,n)=>[n,t(e,n)]))(L,k),B=e.timeRange.to.diff(e.timeRange.from,"seconds"),j=w(t,null===(i=e)||void 0===i?void 0:i.series);return d?E=((e,t,n,o,l,a,i)=>{const r=a?l.divisor*i:l.divisor;return e.map(e=>{const l=e[y.indexLabel.index],a=e[y.indexLabel.label],i=t[l]/r,s=n[l]/r;return o?{label:a,data:[[i,H.dataIn.value],[s,H.dataOut.value]]}:{label:a,data:[[H.dataIn.value,i],[H.dataOut.value,s]]}})})(S,f,h,p,j,m,B):(O=c(f,S,p,j,m,B),x=c(h,S,p,j,m,B)),{separateData:{inByLabel:O,outByLabel:x,ticks:S},stackedData:{metricsByLabel:E,ticks:[[H.dataIn.value,H.dataIn.label],[H.dataOut.value,H.dataOut.label]]}}})(e,o),n=((e,t)=>{const n=t.flowHistogramOptions.mode.label;return"Separate"===n?((e,t)=>{var n,o;const l={label:"In",bars:{show:!0,barWidth:.2,align:"Horizontal"===t?"left":"right"},data:(null===(n=e.separateData)||void 0===n?void 0:n.inByLabel)||[]};return[{label:"Out",bars:{show:!0,barWidth:.2,align:"Horizontal"===t?"right":"left"},data:(null===(o=e.separateData)||void 0===o?void 0:o.outByLabel)||[]},l]})(e,t.flowHistogramOptions.direction.label):"Stacked"===n&&(null===(o=e.stackedData)||void 0===o?void 0:o.metricsByLabel)||[];var o})(t,o),l=((e,t)=>{var n,o;const l="Stacked"===t.flowHistogramOptions.mode.label,a="Horizontal"===t.flowHistogramOptions.direction.label,i="Under Graph"===t.flowHistogramOptions.position.label?5:1,r=t.flowHistogramOptions.showLegend,s=t.flowHistogramOptions.position.value,d={mode:"categories",tickLength:0,ticks:l?null===(n=e.stackedData)||void 0===n?void 0:n.ticks:null===(o=e.separateData)||void 0===o?void 0:o.ticks,autoscaleMargin:.02};return{legend:{show:r,container:void 0,position:s,backgroundOpacity:0,noColumns:i,labelFormatter:(e,t)=>'<a style="margin:3px" >'+e+"</a>"},series:{bars:{align:"center",barWidth:.6,fill:.8,horizontal:a,lineWidth:1,show:!0},stack:l},grid:{borderWidth:0},xaxis:a?{}:d,yaxis:a?d:{}}})(t,o);$.plot(a.current,n,l),(e=>{if(e.flowHistogramOptions.showLegend){const t="Under Graph"===e.flowHistogramOptions.position.label?".flow-histogram-legend-bottom":".flow-histogram-legend-right",n=$(".legend");n&&n.html()&&($(t).html(""),$(t).append(n.html()),n.remove())}})(o)}},[e,n,t,a,o]),d().createElement(d().Fragment,null,d().createElement("style",null,`\n                   .side-spot {\n                        margin-left: 25px;\n                        position: relative;\n                    }                                     \n                    .side-spot .side-spot-label {\n                        transform: rotate(-90deg) translateY(-50%);\n                        transform-origin: center;\n                        top: 42%;\n                        position: absolute;\n                        width: 0;\n                    }\n                    .legendColorBox {\n                        padding-right: 3px;\n                    }\n                    .legendLabel {\n                        color: rgb(204, 204, 220);\n                    }\n                    .side-spot table {\n                        height: ${o.flowHistogramOptions.height}px;\n                    }\n                    .flow-histogram-legend-right table {\n                        margin: 0 auto;\n                    }\n                `),d().createElement("div",null,d().createElement("div",{className:"Horizontal"===o.flowHistogramOptions.direction.label?"":"side-spot",style:m(v.Container,t,n,o)},d().createElement("div",{ref:a,style:m(v.ContainerGraph,t,n,o)}),d().createElement("div",{className:"side-spot-label",style:m(v.GraphAxisLabel,t,n,o)},d().createElement("p",{style:m(v.GraphAxisLabelUnit,t,n,o)},w(o,null===(l=e)||void 0===l?void 0:l.series).units))),d().createElement("div",{className:"Under Graph"===o.flowHistogramOptions.position.label?"flow-histogram-legend-bottom":"flow-histogram-legend-right",style:m(v.Legend,t,n,o)})))}).setPanelOptions(e=>{e.addCustomEditor({id:"flow-histogram-options",path:"flowHistogramOptions",name:"Flow Histogram Panel",editor:B})});return i})());
//# sourceMappingURL=module.js.map