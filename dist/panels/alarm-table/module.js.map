{"version":3,"sources":["../../../src/panels/alarm-table/module.js"],"names":["_","$","MetricsPanelCtrl","loadPluginCss","transformDataToTable","tablePanelEditor","columnOptionsTab","TableRenderer","coreModule","alarmDetailsAsDirective","memoEditorAsDirective","contextMenuAsDirective","SelectionMgr","ActionMgr","dark","light","AlarmTableCtrl","$scope","$injector","$rootScope","annotationsSrv","$sanitize","$compile","datasourceSrv","timeSrv","panelDefaults","targets","transform","pageSize","showHeader","styles","type","pattern","dateFormat","sanitize","unit","decimals","alias","colors","colorMode","thresholds","columns","text","scroll","fontSize","sort","col","desc","severity","severityIcons","pageIndex","panel","fields","defaults","self","selectionMgr","from","to","getRowsInRange","render","events","on","onDataReceived","bind","onDataError","onInitEditMode","addEditorTab","datasource","setTimeQueryStart","getAnnotations","dashboard","range","then","data","annotations","err","dataRaw","dataList","length","table","renderer","isTimezoneUtc","colIndex","scope","elem","attrs","ctrl","pageCount","formaters","getTableHeight","panelHeight","height","appendTableRows","tbodyElem","setTable","empty","html","contents","switchPage","e","el","currentTarget","parseInt","renderPanel","appendPaginationControls","footerElem","Math","ceil","rows","startPage","max","endPage","min","paginationList","i","activeClass","pageLinkElem","append","panelElem","parents","rootElem","find","css","addClass","unbindDestroy","$on","off","renderData","renderingCompleted","source","alarmId","matchedRow","each","filteredRow","row","meta","alarm","id","undefined","$event","isRowSelected","onRowClick","selectedRows","getSelectedRows","map","tableRow","findTableRow","Object","assign","ticketerConfig","filter","getContextMenu","exclusiveModifier","ctrlKey","rangeModifier","shiftKey","handleRowClick","alarmDetails","appEvent","newScope","$new","templateHtml","action","get","ds","indexOf","message","name","error","refreshDashboard","catch","performAlarmActionOnDatasource","findIdx","findIndex","selectionToMatch","startIdx","endIdx","push","templateUrl","directive"],"mappings":"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","file":"module.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport {transformDataToTable} from './transformers';\nimport {tablePanelEditor} from './editor';\nimport {columnOptionsTab} from './column_options';\nimport {TableRenderer} from './renderer';\nimport coreModule from 'app/core/core_module';\nimport {alarmDetailsAsDirective} from './alarm_details';\nimport {memoEditorAsDirective} from \"./memo_editor\"\nimport {contextMenuAsDirective} from \"./context_menu\";\nimport {loadPluginCss} from 'app/plugins/sdk';\nimport {SelectionMgr} from \"./selection_mgr\";\nimport {ActionMgr} from \"./action_mgr\";\n\nloadPluginCss({\n  dark: 'plugins/opennms-helm/panels/alarm-table/css/table.dark.css',\n  light: 'plugins/opennms-helm/panels/alarm-table/css/table.light.css'\n});\n\nclass AlarmTableCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, $rootScope, annotationsSrv, $sanitize, $compile, datasourceSrv, timeSrv) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n    this.annotationsSrv = annotationsSrv;\n    this.$sanitize = $sanitize;\n    this.$compile = $compile;\n    this.datasourceSrv = datasourceSrv;\n    this.timeSrv = timeSrv;\n\n    let panelDefaults = {\n      targets: [{}],\n      transform: 'table',\n      pageSize: 5,\n      showHeader: true,\n      styles: [\n        {\n          type: 'date',\n          pattern: '/.*Time/', // Render all \"* Time\" columns as date, e.g. \"Last Event Time\", \"First Event Time\", etc.\n          dateFormat: 'YYYY-MM-DD HH:mm:ss',\n        },\n        {\n          type: 'date',\n          pattern: 'Suppressed Until',\n          dateFormat: 'YYYY-MM-DD HH:mm:ss',\n        },\n        {\n          type: 'string',\n          pattern: '/.*ID/', // Render all \"* ID\" columns as string, otherwise ID 1000 appears as 1.0 K\n        },\n        {\n          type: 'string',\n          pattern: 'Description',\n          sanitize: true\n        },\n        {\n          unit: 'short',\n          type: 'number',\n          decimals: 0,\n          pattern: 'Count',\n        },\n        {\n          unit: 'short',\n          type: 'number',\n          alias: '',\n          decimals: 2,\n          colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\n          colorMode: null,\n          pattern: '/.*/',\n          thresholds: [],\n        }\n      ],\n      columns: [\n          {text: 'UEI'},\n          {text: 'Log Message'},\n          {text: 'Node Label'},\n          {text: 'Count'},\n          {text: 'Last Event Time',}],\n      scroll: false, // disable scrolling as the actions popup is not working properly otherwise\n      fontSize: '100%',\n      sort: {col: 0, desc: true},\n      severity: true,\n      severityIcons: true\n    };\n\n    this.pageIndex = 0;\n\n    if (this.panel.styles === void 0) {\n      this.panel.styles = this.panel.columns;\n      this.panel.columns = this.panel.fields;\n      delete this.panel.columns;\n      delete this.panel.fields;\n    }\n\n    _.defaults(this.panel, panelDefaults);\n\n    let self = this;\n    this.selectionMgr = new SelectionMgr((from,to) => self.getRowsInRange(from,to), () => self.render());\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n  }\n\n\n  onInitEditMode() {\n    this.addEditorTab('Options', tablePanelEditor, 2);\n    this.addEditorTab('Column Styles', columnOptionsTab, 3);\n  }\n\n  issueQueries(datasource) {\n    this.pageIndex = 0;\n\n    if (this.panel.transform === 'annotations') {\n      this.setTimeQueryStart();\n      return this.annotationsSrv.getAnnotations({dashboard: this.dashboard, panel: this.panel, range: this.range})\n        .then(annotations => {\n          return {data: annotations};\n        });\n    }\n\n    return super.issueQueries(datasource);\n  }\n\n  onDataError(err) {\n    this.dataRaw = [];\n    this.render();\n  }\n\n  onDataReceived(dataList) {\n    this.dataRaw = dataList;\n    this.pageIndex = 0;\n\n    // automatically correct transform mode based on data\n    if (this.dataRaw && this.dataRaw.length) {\n      if (this.dataRaw[0].type === 'table') {\n        this.panel.transform = 'table';\n      } else {\n        if (this.dataRaw[0].type === 'docs') {\n          this.panel.transform = 'json';\n        } else {\n          if (this.panel.transform === 'table' || this.panel.transform === 'json') {\n            this.panel.transform = 'timeseries_to_rows';\n          }\n        }\n      }\n    }\n\n    this.render();\n  }\n\n  render() {\n    this.table = transformDataToTable(this.dataRaw, this.panel);\n    this.table.sort(this.panel.sort);\n\n    this.renderer = new TableRenderer(this.panel, this.table, this.dashboard.isTimezoneUtc(), this.$sanitize, this.selectionMgr);\n\n    return super.render(this.table);\n  }\n\n  toggleColumnSort(col, colIndex) {\n    // remove sort flag from current column\n    if (this.table.columns[this.panel.sort.col]) {\n      this.table.columns[this.panel.sort.col].sort = false;\n    }\n\n    if (this.panel.sort.col === colIndex) {\n      if (this.panel.sort.desc) {\n        this.panel.sort.desc = false;\n      } else {\n        this.panel.sort.col = null;\n      }\n    } else {\n      this.panel.sort.col = colIndex;\n      this.panel.sort.desc = true;\n    }\n    this.render();\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    let data;\n    let panel = ctrl.panel;\n    let pageCount = 0;\n    let formaters = [];\n\n    function getTableHeight() {\n      let panelHeight = ctrl.height;\n\n      if (pageCount > 1) {\n        panelHeight -= 26;\n      }\n\n      return (panelHeight - 31) + 'px';\n    }\n\n    function appendTableRows(tbodyElem) {\n      ctrl.renderer.setTable(data);\n      tbodyElem.empty();\n      tbodyElem.html(ctrl.renderer.render(ctrl.pageIndex));\n      // Compile the HTML generated by the renderer - this is required the row related callbacks (click, dblclick, etc...)\n      ctrl.$compile(tbodyElem.contents())(scope);\n    }\n\n    function switchPage(e) {\n      let el = $(e.currentTarget);\n      ctrl.pageIndex = (parseInt(el.text(), 10) - 1);\n      renderPanel();\n    }\n\n    function appendPaginationControls(footerElem) {\n      footerElem.empty();\n\n      let pageSize = panel.pageSize || 100;\n      pageCount = Math.ceil(data.rows.length / pageSize);\n      if (pageCount === 1) {\n        return;\n      }\n\n      let startPage = Math.max(ctrl.pageIndex - 3, 0);\n      let endPage = Math.min(pageCount, startPage + 9);\n\n      let paginationList = $('<ul></ul>');\n\n      for (let i = startPage; i < endPage; i++) {\n        let activeClass = i === ctrl.pageIndex ? 'active' : '';\n        let pageLinkElem = $('<li><a class=\"table-panel-page-link pointer ' + activeClass + '\">' + (i + 1) + '</a></li>');\n        paginationList.append(pageLinkElem);\n      }\n\n      footerElem.append(paginationList);\n    }\n\n    function renderPanel() {\n      let panelElem = elem.parents('.panel');\n      let rootElem = elem.find('.table-panel-scroll');\n      let tbodyElem = elem.find('tbody');\n      let footerElem = elem.find('.table-panel-footer');\n\n      elem.css({'font-size': panel.fontSize});\n      panelElem.addClass('table-panel-wrapper');\n\n      appendTableRows(tbodyElem);\n      appendPaginationControls(footerElem);\n\n      rootElem.css({'max-height': panel.scroll ? getTableHeight() : ''});\n    }\n\n    elem.on('click', '.table-panel-page-link', switchPage);\n\n    let unbindDestroy = scope.$on('$destroy', function () {\n      elem.off('click', '.table-panel-page-link');\n      unbindDestroy();\n    });\n\n    ctrl.events.on('render', function (renderData) {\n      data = renderData || data;\n      if (data) {\n        renderPanel();\n      }\n      ctrl.renderingCompleted();\n    });\n  }\n\n  // Alarm related actions\n\n  findTableRow(source, alarmId) {\n    let matchedRow;\n    _.each(this.dataRaw, table => {\n      let filteredRow = _.find(table.rows, row => {\n        return row.meta.source === source && row.meta.alarm.id === alarmId;\n      });\n      if (filteredRow !== undefined) {\n        matchedRow = filteredRow;\n      }\n    });\n    return matchedRow;\n  }\n\n  getContextMenu($event, source, alarmId) {\n    // Treat the right click as a left click on the row, if the row is not part of the current selection\n    if (!this.selectionMgr.isRowSelected({\n        source: source,\n        alarmId: alarmId\n      })) {\n      this.onRowClick($event, source, alarmId);\n    }\n\n    // Grab the current selection\n    let selectedRows = this.selectionMgr.getSelectedRows();\n\n    // Load up the actual alarms in the rows\n    let self = this;\n    selectedRows = _.map(selectedRows, row => {\n      // Create new objects instead of modifying the existing rows\n      // returned by SelectionMgr#getSelectedRows()\n      const tableRow = self.findTableRow(row.source, row.alarmId);\n      return Object.assign({}, row, {\n        alarm: tableRow ? tableRow.meta.alarm : undefined,\n        ticketerConfig: tableRow ? tableRow.meta.ticketerConfig : undefined\n      });\n    });\n\n    // Filter out any rows for which we couldn't find the alarm\n    selectedRows = _.filter(selectedRows, row => row.alarm !== void 0);\n\n    // Generate selection-based context menu\n    return new ActionMgr(this, selectedRows).getContextMenu();\n  }\n\n  onRowClick($event, source, alarmId) {\n    let exclusiveModifier = $event.ctrlKey;\n    let rangeModifier = $event.shiftKey;\n    this.selectionMgr.handleRowClick({source: source, alarmId: alarmId}, exclusiveModifier, rangeModifier);\n  }\n\n  onRowDoubleClick($event, source, alarmId) {\n    // Show the alarm details pane\n    this.alarmDetails(source, alarmId);\n  }\n\n  alarmDetails(source, alarmId) {\n    const row = this.findTableRow(source, alarmId);\n    if (row === undefined) {\n      this.$rootScope.appEvent('alert-error', ['Unable to find matching alarm', '']);\n      return;\n    }\n\n    let newScope = this.$rootScope.$new();\n    newScope.source = source;\n    newScope.alarm = row.meta.alarm;\n    newScope.ticketerConfig = row.meta.ticketerConfig;\n\n    this.$rootScope.appEvent('show-modal', {\n      templateHtml: '<alarm-details-as-modal dismiss=\"dismiss()\"></alarm-details-as-modal>',\n      scope: newScope\n    });\n  }\n\n  performAlarmActionOnDatasource(source, action, alarmId) {\n    let self = this;\n    this.datasourceSrv.get(source).then(ds => {\n      if (ds.type && ds.type.indexOf(\"fm-ds\") < 0) {\n        throw {message: 'Only OpenNMS datasources are supported'};\n      } else {\n        if (!ds[action]) {\n          throw {message: 'Action ' + action + ' not implemented by datasource ' + ds.name + \" of type \" + ds.type};\n        }\n        return ds[action](alarmId);\n      }\n    }).then(() => {\n      // Action was successful, remove any previous error\n      delete self.error;\n      // Refresh the dashboard\n      self.timeSrv.refreshDashboard();\n    }).catch(err => {\n      self.error = err.message || \"Request Error\";\n    });\n  }\n\n  acknowledgeAlarm(source, alarmId) {\n    this.performAlarmActionOnDatasource(source, 'acknowledgeAlarm', alarmId);\n  }\n\n  unacknowledgeAlarm(source, alarmId) {\n    this.performAlarmActionOnDatasource(source, 'unacknowledgeAlarm', alarmId);\n  }\n\n  clearAlarm(source, alarmId) {\n    this.performAlarmActionOnDatasource(source, 'clearAlarm', alarmId);\n  }\n\n  escalateAlarm(source, alarmId) {\n    this.performAlarmActionOnDatasource(source, 'escalateAlarm', alarmId);\n  }\n\n  createTicketForAlarm(source, alarmId) {\n    this.performAlarmActionOnDatasource(source, 'createTicketForAlarm', alarmId);\n  }\n\n  updateTicketForAlarm(source, alarmId) {\n    this.performAlarmActionOnDatasource(source, 'updateTicketForAlarm', alarmId);\n  }\n\n  closeTicketForAlarm(source, alarmId) {\n    this.performAlarmActionOnDatasource(source, 'closeTicketForAlarm', alarmId);\n  }\n\n  // Multi-select handling\n  getRowsInRange(from, to) {\n    let rows = [];\n    if (!this.table) {\n      return rows;\n    }\n\n    let findIdx = selectionToMatch => {\n      return _.findIndex(this.table.rows, row => {\n        return row.meta.source === selectionToMatch.source && row.meta.alarm.id === selectionToMatch.alarmId;\n      });\n    };\n\n    let startIdx = findIdx(from);\n    if (startIdx < 0) {\n      return rows;\n    }\n\n    let endIdx = findIdx(to);\n    if (endIdx < 0) {\n      return rows;\n    }\n\n    if (endIdx < startIdx) {\n      // Swap\n      [startIdx,endIdx] = [endIdx,startIdx];\n    }\n\n    for (let i = startIdx; i <= endIdx; i++) {\n      rows.push({\n        source: this.table.rows[i].meta.source,\n        alarmId: this.table.rows[i].meta.alarm.id\n      });\n    }\n    return rows;\n  }\n}\n\nAlarmTableCtrl.templateUrl = 'panels/alarm-table/module.html';\n\nexport {\n  AlarmTableCtrl,\n  AlarmTableCtrl as PanelCtrl\n};\n\ncoreModule.directive('alarmDetailsAsModal',  alarmDetailsAsDirective);\ncoreModule.directive('memoEditor',  memoEditorAsDirective);\ncoreModule.directive('contextMenu', contextMenuAsDirective());\n"]}