{"version":3,"sources":["../../../src/datasources/fault-ds/datasource.js"],"names":["ClientDelegate","API","FilterCloner","_","OpenNMSFMDatasource","instanceSettings","$q","backendSrv","templateSrv","contextSrv","type","url","name","q","alarmClient","jsonData","useGrafanaUser","grafanaUserField","user","login","options","filter","targets","Filter","limit","enforceTimeRange","clonedFilter","buildQuery","self","findAlarms","then","getClientWithMetadata","data","toTable","alarms","client","server","metadata","cloneFilter","withAndRestriction","NestedRestriction","Restriction","Comparators","GE","LE","substitute","clauses","each","clause","restriction","value","range","from","to","replace","scopedVars","datasourceRequest","method","response","status","message","title","when","query","find","getProperties","getPropertyComparators","attribute","searchForValues","findOperators","findProperty","property","id","findUsers","map","rows","label","findNodes","node","findCategories","category","findLocations","location","findSeverities","severity","findServices","service","columnNames","columns","column","row","alarm","logMessage","description","uei","nodeId","nodeLabel","ipAddress","serviceType","undefined","ackUser","firstEventTime","lastEventTime","lastEvent","source","troubleTicket","troubleTicketState","count","meta","ticketerConfig","alarmId","getAlarm","doAck","doUnack","doClear","doEscalate","doTicketAction","sticky","saveSticky","deleteSticky","journal","saveJournal","deleteJournal"],"mappings":"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","file":"datasource.js","sourcesContent":["import {ClientDelegate} from './client_delegate';\nimport {API} from '../../opennms';\nimport {FilterCloner} from \"./FilterCloner\"\nimport _ from 'lodash';\n\nexport class OpenNMSFMDatasource {\n\n  constructor(instanceSettings, $q, backendSrv, templateSrv, contextSrv) {\n    this.type = instanceSettings.type;\n    this.url = instanceSettings.url;\n    this.name = instanceSettings.name;\n    this.q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.alarmClient = new ClientDelegate(instanceSettings, backendSrv, $q);\n\n    // When enabled in the datasource, the grafana user should be used instead of the datasource username on\n    // supported operations\n    if (instanceSettings.jsonData && instanceSettings.jsonData.useGrafanaUser) {\n        // If the datasource contains the field which should be used and that field is set, use it\n        if (instanceSettings.jsonData.grafanaUserField && contextSrv.user[instanceSettings.jsonData.grafanaUserField]) {\n            this.user = contextSrv.user[instanceSettings.jsonData.grafanaUserField];\n        } else { // otherwise the login is used instead\n            this.user = contextSrv.user.login;\n        }\n    }\n  }\n\n  query(options) {\n      // Initialize filter\n      var filter = options.targets[0].filter || new API.Filter();\n      filter.limit = 0; // no limit\n\n      options.enforceTimeRange = true;\n      const clonedFilter = this.buildQuery(filter, options);\n\n      var self = this;\n      return this.alarmClient.findAlarms(clonedFilter).then(alarms => {\n          return this.alarmClient.getClientWithMetadata().then(client => {\n              return {\n                data: self.toTable(alarms, client.server.metadata)\n              };\n          });\n      });\n  }\n\n  // Clone Filter to prevent some issues and also make substitution possible\n  // (otherwise substitution would happen in original query, and overwriting the $<variable> or [[variable]] in restrictions which may not be the intention)\n  buildQuery(filter, options) {\n      var clonedFilter = new FilterCloner().cloneFilter(filter);\n\n      // Before replacing any variables, add a global time range restriction (which is hidden to the user)\n      if (options && options.enforceTimeRange) {\n          clonedFilter.withAndRestriction(\n              new API.NestedRestriction()\n                  .withAndRestriction(new API.Restriction(\"lastEventTime\", API.Comparators.GE, \"$range_from\"))\n                  .withAndRestriction(new API.Restriction(\"lastEventTime\", API.Comparators.LE, \"$range_to\")));\n      }\n\n      // Subsitute $<variable> or [[variable]] in the restriction value\n      this.substitute(clonedFilter.clauses, options);\n      return clonedFilter;\n  }\n\n  substitute(clauses, options) {\n      const self = this;\n      _.each(clauses, clause => {\n        if (clause.restriction) {\n            if (clause.restriction instanceof API.NestedRestriction) {\n                self.substitute(clause.restriction.clauses, options);\n            } else if (clause.restriction.value) {\n                // Range must be of type date, otherwise it is not parseable by the OpenNMS client\n                if (clause.restriction.value === '$range_from' || clause.restriction.value === \"[[range_from]]\") {\n                    clause.restriction.value = options.range.from;\n                } else if (clause.restriction.value === '$range_to' || clause.restriction.value === \"[[range_to]]\") {\n                    clause.restriction.value = options.range.to;\n                } else {\n                    clause.restriction.value = self.templateSrv.replace(clause.restriction.value, options.scopedVars);\n                }\n            }\n        }\n      });\n  }\n\n  testDatasource() {\n    return this.backendSrv.datasourceRequest({\n      url: this.url + '/rest/info',\n      method: 'GET'\n    }).then(response => {\n      if (response.status === 200) {\n        return {status: \"success\", message: \"Data source is working\", title: \"Success\"};\n      }\n    });\n  }\n\n  annotationQuery(options) {\n    return this.q.when([]);\n  }\n\n  metricFindQuery(query) {\n    if (!query || !query.find) {\n        return this.q.when([]);\n    }\n\n    if (query.find === \"attributes\") {\n      return this.alarmClient.getProperties();\n    }\n    if (query.find === \"comparators\") {\n      return this.alarmClient.getPropertyComparators(query.attribute);\n    }\n    if (query.find == 'values') {\n        return this.searchForValues(query);\n    }\n    if (query.find === 'operators') {\n        return this.alarmClient.findOperators();\n    }\n    return this.q.when([]);\n  }\n\n  searchForValues(query) {\n      return this.alarmClient.findProperty(query.attribute)\n          .then(property => {\n              if (!property) {\n                  return this.q.when([]);\n              }\n              switch (property.id) {\n                  case 'alarmAckUser':\n                  case 'suppressedUser':\n                  case 'lastEvent.eventAckUser':\n                      return this.alarmClient.findUsers({query: query.query})\n                          .then(function (data) {\n                              return _.map(data.rows, function (user) {\n                                  return {\n                                      id: user['user-id'],\n                                      label: user['full-name']\n                                  };\n                              });\n                          });\n                  case 'node.label':\n                      return this.alarmClient.findNodes({query: query.query})\n                          .then(function (data) {\n                              return _.map(data.rows, function (node) {\n                                  return {\n                                      id: node.label,\n                                      label: node.label\n                                  }\n                              });\n                          });\n                  case 'category.name':\n                      return this.alarmClient.findCategories({query: query.query})\n                          .then(function (data) {\n                              return _.map(data.rows, function (category) {\n                                  return {\n                                      id: category.id,\n                                      label: category.name\n                                  };\n                              })\n                          });\n                  case 'location.locationName':\n                      return this.alarmClient.findLocations({query: query.query})\n                          .then(function (data) {\n                              return _.map(data.rows, function (location) {\n                                  return {\n                                      id: location['location-name'],\n                                      label: location['location-name']\n                                  };\n                              })\n                          });\n                  case 'severity':\n                      return this.alarmClient.findSeverities({query: query.query})\n                          .then(function (data) {\n                              return _.map(data, function (severity) {\n                                  return {\n                                      id: severity.id,\n                                      label: severity.label\n                                  }\n                              })\n                          });\n                  case 'serviceType.name':\n                      return this.alarmClient.findServices({query: query.query})\n                          .then(function (data) {\n                              return _.map(data.rows, function (service) {\n                                  return {\n                                      id: service,\n                                      label: service\n                                  }\n                              })\n                          });\n          }\n      });\n  }\n\n    // Converts the data fetched from the Alarm REST Endpoint of OpenNMS to the grafana table model\n    toTable(alarms, metadata) {\n        var columnNames = [\n            \"Log Message\", \"Description\",\n            \"UEI\", \"Node ID\", \"Node Label\",\n            \"IP Address\", \"Service\", \"Acked By\", \"Severity\",\n            \"First Event Time\", \"Last Event Time\", \"Event Source\",\n            \"Trouble Ticket\", \"Trouble Ticket State\", \"Count\"];\n\n        var columns = _.map(columnNames, column => {\n            return { \"text\" : column }\n        });\n\n        var rows = _.map(alarms, alarm => {\n            var row = [\n                alarm.logMessage,\n                alarm.description,\n                alarm.uei,\n                alarm.nodeId,\n                alarm.nodeLabel,\n                alarm.ipAddress,\n                alarm.serviceType ? alarm.serviceType.name : undefined,\n                alarm.ackUser,\n                alarm.severity.label,\n                alarm.firstEventTime,\n                alarm.lastEventTime,\n                alarm.lastEvent.source,\n                alarm.troubleTicket,\n                alarm.troubleTicketState,\n                alarm.count\n            ];\n            row.meta = {\n                // Store the alarm for easy access by the panels - may not be necessary\n                'alarm': alarm,\n                // Store the name of the data-source as part of the data so that\n                // the panel can grab an instance of the DS to perform actions\n                // on the alarms\n                \"source\": this.name,\n                // Store the ticketerConfig here\n                \"ticketerConfig\": metadata.ticketerConfig\n            };\n            return row;\n        });\n\n        return [\n            {\n                \"columns\": columns,\n                \"rows\": rows,\n                \"type\": \"table\",\n            }\n        ];\n    }\n\n    getAlarm(alarmId) {\n        return this.alarmClient.getAlarm(alarmId);\n    }\n\n    acknowledgeAlarm(alarmId) {\n        return this.alarmClient.doAck(alarmId, this.user);\n    }\n\n    unacknowledgeAlarm(alarmId) {\n        return this.alarmClient.doUnack(alarmId, this.user);\n    }\n\n    clearAlarm(alarmId) {\n        return this.alarmClient.doClear(alarmId, this.user);\n    }\n\n    escalateAlarm(alarmId) {\n        return this.alarmClient.doEscalate(alarmId, this.user);\n    }\n\n    createTicketForAlarm(alarmId) {\n        return this.alarmClient.doTicketAction(alarmId, \"create\");\n    }\n\n    updateTicketForAlarm(alarmId) {\n        return this.alarmClient.doTicketAction(alarmId, \"update\");\n    }\n\n    closeTicketForAlarm(alarmId) {\n        return this.alarmClient.doTicketAction(alarmId, \"close\");\n    }\n\n    saveSticky(alarmId, sticky) {\n        return this.alarmClient.saveSticky(alarmId, sticky, this.user);\n    }\n\n    deleteSticky(alarmId) {\n        return this.alarmClient.deleteSticky(alarmId);\n    }\n\n    saveJournal(alarmId, journal) {\n        return this.alarmClient.saveJournal(alarmId, journal, this.user);\n    }\n\n    deleteJournal(alarmId) {\n        return this.alarmClient.deleteJournal(alarmId);\n    }\n}\n"]}